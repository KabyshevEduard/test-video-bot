# Как запустить 

1. Поднять базу данных PostgreSQL. Это можно сделать установив ее, либо поднять Докер контейнер, запустив (заменить параметры на свои):
```bash
docker run --name PgDb -e POSTGRES_DB=<имя бд> -e POSTGRES_USER=<имя пользователя бд> -e POSTGRES_PASSWORD=<пароль пользователя бд> -v <путь до папки, куда будут монитрованы данные>:/var/lib/postgresql/data -p 5432:5432 -d postgres:17
```

2. Закинуть videos.json в папку репозитория и создать файл .env с содержимым:
```bash
BOT_TOKEN=<токен бота>
PG_PATH=postgresql+asyncpg://<имя пользователя бд>:<пароль пользователя бд>@localhost/<имя бд>
LLM_TOKEN=<токен сервиса openroute.ai>
```

3. Создать и активировать виртуальное окружение python и установить зависимости
```bash
1. python3 -m venv .venv
2. source .venv/bin/activate
3. pip install -r requirements.txt
```

3. Запустить миграции базы данных и загрузку данных:
```bash
1. alembic upgrade head
2. export PYTHONPATH=$PWD
3. python ETL.py
```

4. Запустить скрипт
```bash
python src/main.py
```

# Подход

Использован подход с промптом LLM для генерации SQL запросов, которые далее передаются в драйвер базы данных postgres

Промпт:<br>
У меня есть база данных с двумя таблицами. В первой таблице videos содержаться данные о видео: 
index - идентификатор видео;
creator_id - идентификатор креатора;
video_created_at - дата и время публикации видео;
views_count - финальное количество просмотров;
likes_count - финальное количество лайков;
comments_count - финальное количество комментариев; 
reports_count - финальное количество жалоб;
created_at - дата и время загрузки видео
updated_at - дата и время обновления видео.
Во второй таблице snapshots содержится информация о видео на каждом часу:
id - идентификатор снапшота;
video_id - foreign key на колонку index таблицы videos;
views_count - количество просмотров на момент замера;
likes_count - количество лайков на момент замера;
comments_count - количество комментариев на момент замера;
reports_count - количество жалоб на момент замера;
delta_views_count - изменение количества просмотров с предыдущего замера;
delta_likes_count - изменение количества лайков с предыдущего замера;
delta_comments_count - изменение количества комментариев с предыдущего замера;
delta_reports_count - изменение количества жалоб с предыдущего замера;
created_at - время замера (раз в час);
updated_at - время изменения.
    
Напиши SQL запрос для того, чтоб получить следующее:
{query}
    
В ответе выведи только SQL запрос.
